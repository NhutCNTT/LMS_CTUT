<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <title>Thư viện Trường ĐH Kỹ Thuật - Công Nghệ Cần Thơ - CTUT</title>
    <link rel="icon" type="image/png" sizes="64x64" th:href="@{/images/user/logo_tab.PNG}">
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />

    <!-- CSS (khối USER) -->
    <link rel="stylesheet" th:href="@{/css/user/layout.css}">
    <link rel="stylesheet" th:href="@{/css/user/header.css}">
    <link rel="stylesheet" th:href="@{/css/user/footer.css}">
    <link rel="stylesheet" th:href="@{/css/user/home.css}">
</head>
<style>
    .book-panel {
        position: fixed;
        top: 0;
        right: -100%; /* ban đầu ẩn hoàn toàn */
        width: 100%;
        max-width: 900px; /* bạn có thể điều chỉnh */
        height: 100%;
        background-color: #fff;
        box-shadow: -2px 0 10px rgba(0,0,0,0.3);
        transition: right 0.5s ease;
        z-index: 2000;
        display: flex;
        flex-direction: column;
    }

    .book-panel.show {
        right: 0; /* trượt vào khi mở */
    }

    .book-panel-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid #ddd;
        padding: 12px 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .close-btn {
        font-size: 28px;
        background: none;
        border: none;
        color: #333;
        cursor: pointer;
        line-height: 1;
    }

    .close-btn:hover {
        color: red;
    }
</style>

<body>
<!-- Header (fragment) -->
<div th:replace="~{components/user/header :: header}"></div>

<!-- Hero Banner -->
<section class="hero-banner position-relative">
    <img th:src="@{/images/user/banner.png}" alt="Thư viện" class="w-100" />

    <div class="search-container">
        <form th:action="@{/user/search}" method="get" class="search-form">
            <input type="text" name="keyword" placeholder="Nhập từ khóa..." required>
            <button type="submit" class="btn-search" aria-label="Tìm kiếm">
                <i class="bi bi-search"></i>
            </button>
        </form>
    </div>
</section>
<div class="container my-4">
    <h3 class="fw-bold text-center mb-4"> Sách đã ghim </h3>

    <div th:if="${pinBooksList.size() == 0}" class="text-center text-muted">
        Bạn chưa ghim cuốn sách nào.
    </div>

    <div th:each="pin, stat : ${pinBooksList}"
         class="search-result-card p-3 mb-3 d-flex align-items-start shadow-sm border rounded">

        <!-- STT -->
        <div class="me-3 text-muted fw-bold" th:text="${stat.index + 1}"></div>

        <!-- Ảnh bìa -->
        <div class="me-3">
            <a th:href="@{/user/books/{id}(id=${pin.books.id})}">

                <img th:src="${pin.books != null && pin.books.image != null && pin.books.image != ''
                           ? pin.books.image
                           : '/images/user/no-cover.png'}"
                     class="rounded"
                     style="width:80px;height:auto;cursor:pointer;">
            </a>
        </div>

        <!-- Nội dung -->
        <div class="flex-grow-1">
            <div class="text-uppercase small text-secondary fw-bold mb-1">BOOK</div>

            <h5 class="fw-semibold mb-1">
                <a th:href="@{/user/books/{id}(id=${pin.books.id})}"
                   th:text="${pin.books.bookName}"
                   class="text-decoration-none text-dark"></a>
            </h5>

            <p class="mb-1 text-muted">
                <span th:text="${pin.books.author}"></span><br>
                <span th:text="${pin.books.category}"></span><br>
                <span th:text="${pin.books.isbn}"></span>
            </p>

            <div class="text-success fw-semibold small">
                <i class="bi bi-link-45deg"></i> Available
            </div>

            <div class="mt-2">
                <a th:href="'https://books.google.com.vn/books?id=' + ${pin.books.bookCode}"
                   target="_blank"
                   class="btn btn-sm btn-outline-primary">
                    Xem chi tiết trên Google Books
                </a>
            </div>
        </div>

        <!-- Action -->
        <div class="ms-3 text-end d-flex flex-column align-items-end">
            <form th:action="@{'/user/deletePin/' + ${pin.books.id}}" method="post">
                <button type="submit" class="btn btn-link text-primary p-1">
                    <i class="bi bi-pin-angle-fill"></i>
                </button>
            </form>
                <button class="btn btn-link text-dark p-1" title="Bình luận"><i class="bi bi-chat-quote"></i></button>
                <button class="btn btn-link text-dark p-1" title="Gửi thư"><i class="bi bi-envelope"></i></button>
                <button class="btn btn-link text-dark p-1" title="Tùy chọn khác"><i class="bi bi-three-dots"></i></button>
            </div>
        </div>
    </div>
</div>
<script>
    function openBookIframe(element) {
        event.preventDefault();
        const code = element.getAttribute('data-code');
        const title = element.textContent;

        const iframe = document.getElementById('bookPanelFrame');
        const panel = document.getElementById('bookPanel');
        const panelTitle = document.getElementById('bookPanelTitle');

        panelTitle.textContent = title;
        iframe.src = `https://books.google.com.vn/books?id=${code}&hl=vi&pg=PP1&output=embed`;

        panel.classList.add('show');
    }

    function closeBookPanel() {
        const panel = document.getElementById('bookPanel');
        const iframe = document.getElementById('bookPanelFrame');

        panel.classList.remove('show');
        iframe.src = ""; // ngắt tải sách khi đóng lại
    }
</script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        // Nếu có lưu vị trí scroll thì quay lại
        if (sessionStorage.scrollPosition) {
            window.scrollTo(0, sessionStorage.scrollPosition);
            sessionStorage.removeItem("scrollPosition");
        }

        // Trước khi rời trang (bấm submit form), lưu lại vị trí scroll
        document.querySelectorAll("form").forEach(form => {
            form.addEventListener("submit", () => {
                sessionStorage.scrollPosition = window.scrollY;
            });
        });
    });
</script>


</body>
</html>